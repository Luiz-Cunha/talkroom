<div class="profile-background">
  <div class= "container profile-border">
    <h1>Welcome</h1>
    <p>
    Hello and welcome to TalkRoom, a platform dedicated to providing accessible mental health support while helping you gain valuable real-world experience. We are thrilled to have you join our team of passionate and compassionate counsellors.</p>
  </div>
</div>

<div class="container">
  <div class="counsellor-data d-flex justify-content-center py-4">
    <div class="container justify-content-center">
      <div class="row align-items-center py-4">
        <div class="col-md-4 text-center">
          <img src="<%= current_counsellor.photo.attached? ? cl_image_path(current_counsellor.photo.key) : asset_path('patient1.png') %>" alt="Profile" class="counsellor-image">
        </div>
      <div class="col-md-8">
        <p><strong>Email:</strong> <%= @counsellor.email %></p>
        <p><strong>Full Name:</strong> <%= @counsellor.fullname %></p>
        <p><strong>Gender:</strong> <%= @counsellor.gender %></p>
        <p><strong>Location:</strong> <%= @counsellor.location %></p>
        <p><strong>Date of Birth:</strong> <%= @counsellor.birthdate.strftime("%B %d, %Y") if @counsellor.birthdate %></p>
        <p><strong>University Name:</strong> <%= @counsellor.university_name %></p>
        <p><strong>University ID:</strong> <%= @counsellor.university_id %></p>
        <p><strong>Degree Program:</strong> <%= @counsellor.degree_program %></p>
        <p><strong>Year of Study:</strong> <%= @counsellor.year_of_study %></p>
        <p><strong>Expected Graduation Date:</strong> <%= @counsellor.expected_graduation_date %></p>
        <div class=" d-flex "> <%= link_to 'Change Password', edit_user_registration_path, class: 'btn-change-password' %></div>
      </div>
    </div>
  </div>
</div>
</div>



<div class="container previous-appointments d-flex justify-content-center">
  <div class="col-md-4 mb-4">
    <img src="/assets/counsellor2.png" class="img-fluid">
  </div>

  <div id="carouselPendingAppointments" class="carousel slide col-md-8" >
    <div class="carousel-inner">
      <% @appointments.order(created_at: :desc).each_with_index do |appointment, index| %>

        <div class="carousel-item <%= 'active' if index == 0 %>">
          <div class="row justify-content-center">
            <div class="col-md-6 mb-4">
              <div class="card-previous-appointments">
                <div class="appointment-card-details">
                  <% if appointment.user.photo.attached? %>
                    <%= image_tag cl_image_path(appointment.user.photo.key), alt: 'Profile Photo', class: 'img-fluid img-counsellor' %>
                  <% else %>
                    <%= image_tag asset_path('patient1.png'), alt: 'Default Profile Photo', class: 'img-fluid img-counsellor' %>
                  <% end %>
                  <%= render 'appointment_accept', appointment: appointment %>
                      <% if appointment.counsellor_id == current_counsellor.id %>
                        <% chatroom = ClientChatroom.find_by(user_id: appointment.user_id, counsellor_id: appointment.counsellor_id) %>
                        <% end %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselPendingAppointments" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselPendingAppointments" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>
</div>


<div class="big-tag w-100">
  <%= image_tag 'home8.png', loading: 'lazy', class:'imag1' %>
  <div class="big-tag2">
    <h1>Taking care of your mental health is essential for your overall well-being</h1>
    <%= image_tag 'home7.png', loading: 'lazy', class:'imag2'%>
  </div>
</div>

<div class="previous-title">
  On-going Appointments
</div>

<div class="container previous-appointments d-flex justify-content-center">
  <div class="col-md-4 mb-4">
    <% if current_user && current_user.photo.attached? %>
      <%= image_tag cl_image_path(current_user.photo.key), alt: 'Profile Photo', class: 'img-fluid' %>
    <% else %>
      <%= image_tag asset_path('patient1.png'), alt: 'Default Profile Photo', class: 'img-fluid' %>
    <% end %>
  </div>

  <div id="carouselOnGoingAppointments" class="carousel slide col-md-8" data-bs-ride="carousel">
    <div class="carousel-inner">
      <% @appointments_confirmed.each_slice(3).with_index do |appointment_group, index| %>
        <div class="carousel-item <%= 'active' if index == 0 %>">
          <div class="row justify-content-center">
            <% appointment_group.each do |appointmentC| %>
              <div class="col-md-4 mb-4">
                <div class="card-previous-appointments">
                  <ul class="list-group">
                    <li class="list-group-item">
                      <div class="card-appointments flex-grow-1">
                        <div>
                          <span class="font-weight-bold">Patient name:</span>
                          <span><%= appointmentC.user.fullname %></span>
                        </div>
                        <div>
                          <span class="font-weight-bold">Symptom:</span>
                          <span><%= appointmentC.symptom %></span>
                        </div>
                        <div>
                          <span class="font-weight-bold">Schedule Time:</span>
                          <span><%= appointmentC.schedule_time.strftime("%B %d, %Y at %I:%M %p") if appointmentC.present? %></span>
                        </div>
                        <div>
                          <% if appointmentC.user && appointmentC.user.photo.attached? %>
                            <%= image_tag cl_image_path(appointmentC.user.photo.key), alt: 'Profile Photo', class: 'img-counsellor' %>
                          <% else %>
                            <%= image_tag asset_path('patient1.png'), alt: 'Default Profile Photo', class: 'img-counsellor' %>
                          <% end %>
                        </div>
                        <div>
                          <% if appointmentC.counsellor_id == current_counsellor.id %>
                            <% chatroom = ClientChatroom.find_by(user_id: appointmentC.user_id, counsellor_id: appointmentC.counsellor_id) %>
                            <% if chatroom.present? %>
                              <%= link_to 'Your Chatroom', client_chatroom_path(chatroom), class: "btn btn-primary btn-sm" %>
                            <% else %>
                              <%= button_to 'Create Chatroom', client_chatrooms_path(user_id: appointmentC.user_id, counsellor_id: appointmentC.counsellor_id), method: :post, class: "btn btn-primary btn-sm" %>
                            <% end %>
                          <% end %>
                          <%= button_to 'Delete', appointment_path(appointmentC), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger btn-sm ms-2' %>
                        </div>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <button class="carousel-control-prev" type="button" data-bs-target="#carouselOnGoingAppointments" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselOnGoingAppointments" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>
</div>
