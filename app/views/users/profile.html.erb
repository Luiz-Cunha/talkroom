<div class="profile-background">
  <div class= "container profile-border">
    <h1>Welcome</h1>
    <p>
      Hello and welcome to TalkRoom, your platform for accessible and free psychological support. We are delighted to have you here and want to ensure that you receive all the support necessary to take care of your mental health.</p>
  </div>
</div>

<div class="profile-data">
  <div class="container justify-content-center ">
    <div class="d-flex justify-content-center py-4">
      <img src="<%= current_user.photo.attached? ? cl_image_path(current_user.photo.key) : asset_path('patient1.png') %>" alt="Profile" class="profile-image">
      <div>
        <p><strong><i class="fa-solid fa-envelope"></i></strong> <%= @user.email %></p>
        <p><strong><i class="fa-solid fa-user"></i></strong> <%= @user.fullname %></p>
        <p><strong><i class="fa-solid fa-venus-mars"></i></strong> <%= @user.gender %></p>
        <p><strong><i class="fa-solid fa-location-dot"></i></strong> <%= @user.location %></p>
        <p><strong><i class="fa-solid fa-cake-candles"></i></strong> <%= @user.birthdate.strftime("%B %d, %Y") if @user.birthdate %></p>
        <p><strong><i class="fa-solid fa-notes-medical"></i></strong> <%= @user.other_issues %></p>
        <p><strong><i class="fa-solid fa-file-medical"></i></strong></p>
        <p><%= @user.consultation_history %></p>

        <%= link_to 'Change Password', edit_user_registration_path, class: 'btn-wrap' %>
      </div>
    </div>
  </div>
</div>

<div data-controller="toggle" data-toggle-value="<%= user_signed_in? %>">
  <div class="container my-2 <%= 'd-none' unless @appointment.errors.any? %>" data-toggle-target="formToggle" data-patients-target="hideForm">
    <%= simple_form_for @appointment, html: { data: { action: "turbo:submit-end->patients#resetForm" }} do |f| %>
      <%= f.input :schedule_time, as: :datetime %>
      <%= f.input :symptom, as: :text %>
      <%= f.button :submit, 'Book Appointment' %>
    <% end %>
  </div>
</div>

<div class="container">

    <div id="carouselAppointments" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            <% @appointments.order(created_at: :desc).each_slice(3).with_index do |appointment_group, index| %>
              <div class="carousel-item <%= 'active' if index == 0 %>">
                <div class="d-flex">
                    <% appointment_group.each do |appointment| %>
                      <div class="card-appoitments">
                        <img src="https://randomuser.me/api/portraits/women/30.jpg" alt="">
                        <h1>Pending</h1>
                        <p>Confirmed:<%= appointment.confirmation %></p>
                        <p>Schedule time: <%= appointment.schedule_time %></p>
                        <p>Symptom:<%= appointment.symptom %> </p>
                      </div>
                    <% end %>
                </div>


              </div>
            <% end %>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselAppointments" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselAppointments" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

  <div class="btn">

  </div>

</div>







<div class="appointments">
  <h1>Appointments</h1>
  <% if @appointments.any? %>
    <div class="container d-flex">
      <div class="w-50">
        <div id="carouselAppointments" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            <% @appointments.order(created_at: :desc).each_slice(3).with_index do |appointment_group, index| %>
              <div class="carousel-item <%= 'active' if index == 0 %>">
                <div class="row">
                  <% appointment_group.each do |appointment| %>
                    <div class="col-md-6 mb-4">
                      <div class="card h-75">
                        <div class="card-body">
                          <%= render "users/appointment_user", appointment: appointment %>
                        </div>
                      </div>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselAppointments" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselAppointments" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>

      <div class="ms-4 align-self-end">
        <%= image_tag 'home1.png', class: 'side-image' %>
      </div>
    </div>
  <% else %>
    <p class="text-center">You have no appointments.</p>
  <% end %>

  <div class="my-4">
    <button class="btn btn-lg btn-wrap1" data-action="click->toggle#fire">
      <%= link_to 'Book an appointment', new_appointment_path(@appointment), class: 'btn-wrap' %>
    </button>
  </div>
</div>





  <div class="wrap-35">
    <%= image_tag 'home8.png', loading: 'lazy', class: 'imga-5' %>
    <div class="wrap-37">
      <div class="wrap-38">Taking care of your mental health is essential for your overall well-being</div>
      <%= image_tag 'home7.png', loading: 'lazy', class: 'imga-6' %>
    </div>
  </div>

  <div class="wrap-39">Previous Appointments</div>
  <div class="wrap-40">
    <div id="carouselPreviousAppointments" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-inner">
        <% @previous_appointments.each_with_index do |appointment, index| %>
          <div class="carousel-item <%= 'active' if index.zero? %>">
            <div class="card">
              <div class="card-body d-flex align-items-center">
                <% if appointment.counsellor %>
                  <% if appointment.counsellor.photo.attached? %>
                    <img src="<%= cl_image_path(appointment.counsellor.photo.key) %>" alt="Counsellor Photo" class="profile-image me-3">
                  <% else %>
                    <img src="<%= asset_path('default_profile.png') %>" alt="Default Profile Photo" class="profile-image me-3">
                  <% end %>
                <% end %>
                <div>
                  <h5 class="card-title">Counsellor name: <%= appointment.counsellor&.fullname %></h5>
                  <p class="card-text">
                    Schedule time: <%= appointment.schedule_time.strftime("%B %d, %Y at %I:%M %p") %><br />
                    Symptom: <%= appointment.symptom %>
                  </p>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#carouselPreviousAppointments" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#carouselPreviousAppointments" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>
  </div>
</div>
